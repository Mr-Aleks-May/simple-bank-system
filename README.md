# Simple Bank System Application (Final)

### Содержание:

1. Установка и запуск
2. Робота с БД.
3. Примеры запросов.  
4. API для тестирования.
5. Коды ответов (ошибки).
  
   
  

### I. Setup and config
Для создания данного проекта была использована IDE Spring Tool Suite™ 3 ([sts-3.9.11.RELEASE](https://download.springsource.com/release/STS/3.9.11.RELEASE/dist/e4.14/spring-tool-suite-3.9.11.RELEASE-e4.14.0-win32-x86_64.zip)).
Последнюю версию Вы можете загрузить с [официального сайта](https://spring.io/tools3/sts/all).


### II. Working with DB  
В данном разделе будет приведена информация по настройке и работе с базой данных.  
В качестве базы данных была выбрана Postgresql (v9.6).  
Запросы для создания всех необходимых таблиц находяться в файле init.sql (в этом каталоге).  
Ниже приводиться описание таблиц.  

Для доступа к базе данных (в разработаном приложении) используються следущие данные:  
```
databasename: bank
username: root
password: qwerty1
```
Примечания:\
*1. Если у Вас они отличаються, то измените их в классе DBSettings.*  

**Customers** - данная таблица необходима для хранения персональной информации о пользователе.\
**Tokens** - в этой таблице храняться (временные) ключи доступа. Они необходимы для того, чтобы после аутентификации пользователь больше не отправлял свои email и пароль (является не очень безопастным), а получил временный токен, используя который, можно было проводить различные операции с аккаунтом (снятие, пополнение, просмотр баланса...).  
***Примечания:***\
*1. После успешной аутентификации старый токен становиться не действительным. То есть, в одно и тоже время, пользователь может работать только с 1 приложения\устройства.*  

**Accounts** - храниться информация о счетах пользователей.\
**Transaction** - в данной таблице находиться информация о транзакциях проведенных пользователями.\
**Currencys** - в этой таблице находиться дополнительная информация про валюты в которых может быть открыт счет и проведены различные операции.

### III. Examles of requests
**1. Запрос для регистрации нового клиента:**\
<**POST**> `http://localhost:8080/api/signup?email=api.test@mail.com&password=5f4dcc3b5aa765d61d8327deb882cf99`

***Возможные ответы:***\
Параметр "status":
>0 - клиент успешно зарегистрирован.\
600 - не коректный email.\
601 - не коректный пароль.\
100 - клиент с таким email уже существует.\
300 - произошла ошибка при открытии нового счета для клиента.\
500 - при выполнении запроса на сервере произошла ошибка.  


**2. Запрос аутентификации от клиента:**\
<**POST**> `http://localhost:8080/api/signin?email=api.test@mail.com&password=5f4dcc3b5aa765d61d8327deb882cf99`

***Возможные ответы:***\
Параметр "status":
>0 - успешная аутентификация.\
600 - не коректный email.\
601 - не коректный пароль.\
300 - клиента с указанныс email не существует.\
301 - пароли не совпадают.\
500 - при выполнении запроса на сервере произошла ошибка.  

***Примечание:*** *пароли должны приходить в виде хеша полученого с помощью алгоритма md5, и иметь длину 32 символа.*  

Параметр "token":
>Если "status" равно 0, то будет возвращен временный ключ доступа в параметре "token", иначе данного параметра не будет в ответе.  


**3. Запрос на внесение средств на счет:**\
<**POST**> `http://localhost:8080/api/account/deposite?token=ykPQqt38yBDHeGi4OIK9obdRxtrX7rwW&account=1&amount=100.66`

***Возможные ответы:***\
Параметр "status":
>0 - указанная сумма была успешно внесена на счет.\
602 - не коректный токен.\
302 - токен недействителен.\
201 - для указаного клиента не был открыт счет.\
500 - при выполнении запроса на сервере произошла ошибка.  

Параметр "balance":
>Если "status" = 0, то возвращается текущий баланс счета. Иначе, параметра "balance" не будет.  


**4. Запрос на снятие средств со счета:**\
<**POST**> `http://localhost:8080/api/account/withdraw?token=ykPQqt38yBDHeGi4OIK9obdRxtrX7rwW&account=1&amount=75.66`

***Возможные ответы:***\
Параметр "status":
>0 - указанная сумма была успешно снята со счета.\
602 - не коректный токен.\
302 - токен недействителен.\
201 - для указаного клиента не был открыт счет.\
401 - на счету не достаточно денег.\
500 - при выполнении запроса на сервере произошла ошибка.  

Параметр "balance":
>Если "status" равен 0 или 401, то возвращается текущий баланс счета. Иначе, параметра "balance" не будет.  


**5. Запрос остатка на счету:**\
<**POST**> `http://localhost:8080/api/account/get_balance?token=ykPQqt38yBDHeGi4OIK9obdRxtrX7rwW&account=1`

***Возможные ответы:***\
Параметр "status":
>0 - остаток на балансе был отправлен в параметре "balance".\
602 - не коректный токен.\
302 - токен недействителен.\
201 - для указаного клиента не был открыт счет.\
500 - при выполнении запроса на сервере произошла ошибка.

Параметр "balance":
>Если в параметре "status" возвращено 0, то в параметре "balance" будет возвращен остаток на счету.\
Иначе, параметра "balance" не будет.


**6. Запрос на получение истории транзакций:**\
<**POST**> `http://localhost:8080/api/account/view/transactions?token=ykPQqt38yBDHeGi4OIK9obdRxtrX7rwW&account=1&from=1.01.2020&to=2.2.2022`

***Возможные ответы:***\
Параметр "status":  
>0 - список транзакций будет возвращен в параметре "transactions" (масив).\
602 - не коректный токен.\
302 - токен недействителен.\
603 - дата в параметре from больше даты в параметре to (должно быть наоборот).\
500 - при выполнении запроса на сервере произошла ошибка.

Параметр "transactions":  
>Если в "status" 0, то в параметре "transactions" находиться список всех транзакций за выбраный период (включительно).  
Иначе, данного парамера не будет в ответе.  

**7. Запрос на получение списка всех счетов пользователя:**\
<**POST**> `http://localhost:8080/api/get_accounts?token=ykPQqt38yBDHeGi4OIK9obdRxtrX7rwW`  

***Возможные ответы:***\
Параметр "status":  
>0 - список транзакций будет возвращен в параметре "transactions" (масив).\
602 - не коректный токен.\
302 - токен недействителен.\
500 - при выполнении запроса на сервере произошла ошибка.  

Параметр "accounts":  
>Если в "status" 0, то в параметре "accounts" находиться список всех счетов пользователя.  
Иначе, данного парамера не будет в ответе.  


### IV. API requests for testing
<**GET**> `http://localhost:8080/api/test/signup?email=api.user@mail.com&password=5f4dcc3b5aa765d61d8327deb882cf99`  
<**GET**> `http://localhost:8080/api/test/signin?email=api.user@mail.com&password=5f4dcc3b5aa765d61d8327deb882cf99`  
<**GET**> `http://localhost:8080/api/test/account/deposite?token=9vSTQyHOSslYhJZK01HqSuUgGwNEVb8g&account=1&amount=100`  
<**GET**> `http://localhost:8080/api/test/account/withdraw?token=9vSTQyHOSslYhJZK01HqSuUgGwNEVb8g&account=1&amount=75.06`  
<**GET**> `http://localhost:8080/api/test/account/get_balance?token=9vSTQyHOSslYhJZK01HqSuUgGwNEVb8g&account=1`  
<**GET**> `http://localhost:8080/api/test/account/view/transactions?token=9vSTQyHOSslYhJZK01HqSuUgGwNEVb8g&account=1&from=1.1.2020&to=2.2.2022`  
<**GET**> `http://localhost:8080/api/test/get_accounts?token=9vSTQyHOSslYhJZK01HqSuUgGwNEVb8g`  

### V. Exceptions  
На данный момент, ошибки\исключения разделяються на 6 категорий.  
Они приведены ниже в формате: код ошибки\ответа. (возникающее исключение). - Из-за чего возникла ошибка\исключение.  

**Ошибки возникающие при регистрации пользователя:**  
**100** *(ClientAlreadyExistsException)* - `Означает, что клиент с таким email адресом уже был зарегистрирован.`  

**Ошибки возникающие при работе со счетом (аккаутом):**  
**200** *(AccountNotCreatedException)* - `Произошла ошибка при открытии счета.`  
**201** *(AccountNotFoundException)* - `Счет не существует\принадлежит другому клиенту.`  

**Ошибки аутентификации:**  
**300** *(ClientNotExistsException)* - `Клиента с указаными данными (email), сейчас не существует.`  
**301** *(WrongPasswordException)* - `Пароль отличается от требуемого.`  
**302** *(TokenNotValidException)* - `Токен устарел.`  

**Ошибки при совершении транзакций:**  
**400** *(BankTransactionException)* - `Ошибка при переводе денег между счетами клиентов.`  
**401** *(InsufficientFundException)* - `Количество денег находящееся на указаном счете, недостаточное для совершения операции.`  

**Внутрение ошибки:**  
**500** *(InternalServerError)* - `Внутреняя ошибка произошедшая на сервере. Детали в логах.`  

**Неверные данные в параметрах:**  
**600** *(-)* - `Указаный email адрес, не является коректным.`  
**601** *(-)* - `Пароль не коректен (длина пароля не равна 32 символам).`  
**602** *(-)* - `Токен не коректен (длина не равна 32).`  
**603** *(WrongDateException)* - `Не верно указаные даты в параметрах from(с какого числа начинать) и to(каким заканчивать). from > to.` 

